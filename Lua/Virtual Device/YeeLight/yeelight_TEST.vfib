{"name":"yeelight TEST","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"--[[\n\nfibaro:debug(\"--------------------------------------------------------------------\");\nlocal Yeelight_Device_ID = fibaro:getSelfId();\nfibaro:debug(\"YEELIGHT ID = \"..Yeelight_Device_ID);\nlocal Yeelight_IP_Address = fibaro:getValue(Yeelight_Device_ID, 'IPAddress');\nfibaro:debug(\"YEELIGHT IP ADDRESS = \"..Yeelight_IP_Address);\nlocal Yeelight_TCP_Port = fibaro:getValue(Yeelight_Device_ID, 'TCPPort');\nfibaro:debug(\"YEELIGHT TCP PORT = \"..Yeelight_TCP_Port);\nfibaro:debug(\"--------------------------------------------------------------------\");\nlocal Yeelight_Console = Net.FTcpSocket(Yeelight_IP_Address, Yeelight_TCP_Port);\nbytes, errorCode = Yeelight_Console:write('C 143E,150,150,0,30,\\r\\n');\n\n\nbytes, errorCode = Yeelight_Console:write('C 287B,,,,50,\\n');\nfibaro:sleep(6);\nbytes, errorCode = Yeelight_Console:write('C 143E,,,,50,\\n');\n\n\nbytes, errorCode = Yeelight_Console:write('GL\\n');\n\n\nfibaro:sleep(25);\ns = Yeelight_Console:read();\n\nfibaro:debug(s);\n--]]","ui.Label2.value":"","ui.label_2_0.value":"","ui.label_2_1.value":"","visible":"true","rows":[{"type":"button","elements":[{"id":1,"lua":true,"waitForResponse":false,"caption":"reading_mode","name":"Button11","empty":false,"msg":"local Yeelight_Device_ID = fibaro:getSelfId();\nfibaro:debug(\"YEELIGHT ID = \"..Yeelight_Device_ID);\nlocal Yeelight_IP_Address = fibaro:getValue(Yeelight_Device_ID, 'IPAddress');\nfibaro:debug(\"YEELIGHT IP ADDRESS = \"..Yeelight_IP_Address);\nlocal Yeelight_TCP_Port = fibaro:getValue(Yeelight_Device_ID, 'TCPPort');\nfibaro:debug(\"YEELIGHT TCP PORT = \"..Yeelight_TCP_Port);\nlocal Yeelight_Console = Net.FTcpSocket(Yeelight_IP_Address, Yeelight_TCP_Port);\n\nbytes, errorCode = Yeelight_Console:write('C 0001,210,105,30,50\\r\\n');\n","buttonIcon":0,"favourite":false,"main":true}]},{"type":"button","elements":[{"id":2,"lua":true,"waitForResponse":false,"caption":"ON","name":"Button21","empty":false,"msg":"local Yeelight_Device_ID = fibaro:getSelfId();\nfibaro:debug(\"YEELIGHT ID = \"..Yeelight_Device_ID);\nlocal Yeelight_IP_Address = fibaro:getValue(Yeelight_Device_ID, 'IPAddress');\nfibaro:debug(\"YEELIGHT IP ADDRESS = \"..Yeelight_IP_Address);\nlocal Yeelight_TCP_Port = fibaro:getValue(Yeelight_Device_ID, 'TCPPort');\nfibaro:debug(\"YEELIGHT TCP PORT = \"..Yeelight_TCP_Port);\nlocal Yeelight_Console = Net.FTcpSocket(Yeelight_IP_Address, Yeelight_TCP_Port);\n\n\ntest1 = Yeelight_Console:write('C 287B,255,255,0,50,\\r\\n');\n\nfibaro:sleep(6);\ntest2 = Yeelight_Console:write('C 143E,255,255,0,50,\\r\\n');\nfibaro:sleep(6);","buttonIcon":0,"favourite":false,"main":false},{"id":3,"lua":true,"waitForResponse":false,"caption":"OFF","name":"Button22","empty":false,"msg":"local Yeelight_Device_ID = fibaro:getSelfId();\nfibaro:debug(\"YEELIGHT ID = \"..Yeelight_Device_ID);\nlocal Yeelight_IP_Address = fibaro:getValue(Yeelight_Device_ID, 'IPAddress');\nfibaro:debug(\"YEELIGHT IP ADDRESS = \"..Yeelight_IP_Address);\nlocal Yeelight_TCP_Port = fibaro:getValue(Yeelight_Device_ID, 'TCPPort');\nfibaro:debug(\"YEELIGHT TCP PORT = \"..Yeelight_TCP_Port);\nlocal Yeelight_Console = Net.FTcpSocket(Yeelight_IP_Address, Yeelight_TCP_Port);\ntest1 = Yeelight_Console:write('C 287B,,,,0,\\n');\nfibaro:sleep(6);\nteset2 = Yeelight_Console:write('C 143E,,,,0,\\n');\nfibaro:sleep(6);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":4,"lua":false,"waitForResponse":false,"caption":"ON/OFF STATUS","name":"label_2_1","favourite":false,"main":true}]},{"type":"button","elements":[{"id":5,"lua":true,"waitForResponse":false,"caption":"ON_OFF_BUTTON","name":"Button41","empty":false,"msg":"local id = fibaro:getSelfId()\nif( fibaro:getValue( id , 'ui.label_2_0.value' ) == 'ON' ) then\n\tfibaro:call( id , 'setProperty' , 'ui.label_2_0.value' , 'OFF')\nelse\n\tfibaro:call( id , 'setProperty' , 'ui.label_2_0.value' , 'ON' )\nend","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":6,"lua":true,"waitForResponse":false,"caption":"TEST STRING","name":"button_4_0","empty":false,"msg":"fibaro:debug(\"--------------------------------------------------------------------\");\nlocal Yeelight_Device_ID = fibaro:getSelfId();\nfibaro:debug(\"YEELIGHT ID = \"..Yeelight_Device_ID);\nlocal Yeelight_IP_Address = fibaro:getValue(Yeelight_Device_ID, 'IPAddress');\nfibaro:debug(\"YEELIGHT IP ADDRESS = \"..Yeelight_IP_Address);\nlocal Yeelight_TCP_Port = fibaro:getValue(Yeelight_Device_ID, 'TCPPort');\nfibaro:debug(\"YEELIGHT TCP PORT = \"..Yeelight_TCP_Port);\nfibaro:debug(\"--------------------------------------------------------------------\");\nlocal Yeelight_Console = Net.FTcpSocket(Yeelight_IP_Address, Yeelight_TCP_Port);\nlocal hold = 0;\nlocal next_GLB_found = false;\nlocal append=\"\";\n\nwhile fibaro:getValue( fibaro:getSelfId() , 'ui.label_2_0.value' ) == 'ON' do\n        bytes, errorCode = Yeelight_Console:write('GL\\n');\n        s = Yeelight_Console:read();\n \n\n        if string.find(s,\"GLB\") then\n      \t\thold=hold+1;\n        end\n  \t\t\n  \t\tif hold ==2 then\n    \tbreak;\n    \tend\n  \n  \t\tappend = append..s;\n  \nend\n\nfibaro:debug(append);\nlocal t={};\nlocal i = 1;\nfor value in string.gmatch(append, \"%w+,%d+,%d+,%d+,%d+,%d+,%d+,%d+,%d+\") do\nt[i] = value;\ni = i + 1;\n--ibaro:debug(word);\nend\n\nfibaro:debug(t[1]);\nfibaro:debug(t[2]);\nfibaro:debug(t[3]);","buttonIcon":0,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":7,"lua":false,"waitForResponse":false,"caption":"Label 2","name":"Label2","favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}