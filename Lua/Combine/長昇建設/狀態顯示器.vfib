{"name":"狀態顯示器","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"local mLogCount = 5\t\t\t\t\t-- 本顯示器log欄位有幾個，含第一個狀態模式\nlocal gHouseState = \"HouseState\"\t-- 儲存屋子模式的global value\nlocal gEventLogs = \"EventLogs\"\t\t-- 儲存Log的global value\nlocal mLogSeperatorChar = \";\"\t\t-- global log內每個log的區別符號\nlocal mLabelPrefix = \"Label\"\t\t-- 每個Label的prefix name\n\nlocal selfId = fibaro:getSelfId()\n\nlocal houseModeLabelName = \"ui.\" .. mLabelPrefix .. \"1.value\"\nlocal houseModeValue = fibaro:getGlobal( gHouseState )\nlocal houseOriModeValue = fibaro:getValue( selfId , houseModeLabelName )\n\n\nif houseOriModeValue ~= houseModeValue then\n  fibaro:call( selfId , \"setProperty\" , houseModeLabelName , houseModeValue )\n\tlocal mHttp = Net.FHttp(\"192.168.0.19\",8080);\n  \t  houseModeValue=houseModeValue:gsub(\" \",\"%%20\")\n\tresponse, status, errorCode = mHttp:GET(\"/api/demo/set/singo\" .. \"/\" .. houseModeValue);\nend\n\nlocal eventLogs , updateTimeStamp = fibaro:getGlobal( gEventLogs )\nif eventLogs ~= \"\" then\n  tLogs = {}\n  local start , last = 1 , 0\n  while last < #eventLogs do\n  \tlast = eventLogs:find( mLogSeperatorChar , start )\n    if last ~= nil then\n      local event=eventLogs:sub( start , last - 1 )\n      local mHttp = Net.FHttp(\"192.168.0.19\",8080);\n\t  table.insert( tLogs , event )\n      -- TODO call server with event\n      event=event:gsub(\" \",\"%%20\")\n      fibaro:debug(event)\n      response, status, errorCode = mHttp:GET(\"/api/demo/set/event/\" .. event );\n\n    else\n      table.insert( tLogs , eventLogs:sub( start ) )\n      fibaro:debug( '<span style=\"color:red\">' .. eventLogs:sub( start ) .. '</span>' )\n      break\n    end\n    start = last + 1\n  end\n  \n  tLogs[ #tLogs ] = tLogs[ #tLogs ] .. \" @\" .. os.date( \"%X\" , updateTimeStamp )\n  \n  local eventLogLabelName = \"\"\n  for i = 2 , mLogCount do\n    eventLogLabelName = \"ui.\" .. mLabelPrefix .. i .. \".value\"\n    eventLogValue = fibaro:getValue( selfId , eventLogLabelName )\n    table.insert( tLogs , eventLogValue )\n    fibaro:call( selfId , \"setProperty\" , eventLogLabelName , tLogs[ i - 1 ] )\n  end\n  \n  fibaro:setGlobal( gEventLogs , \"\" )\nend","ui.Label1.value":"NaN","ui.Label2.value":"NaN @11:12:48","ui.Label3.value":"NaN @12:30:46","ui.Label4.value":"NaN @12:30:44","ui.Label5.value":"NaN @12:29:28","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"房屋模式","name":"Label1","favourite":false,"main":true}]},{"type":"label","elements":[{"id":2,"lua":false,"waitForResponse":false,"caption":"Log","name":"Label2","favourite":false,"main":false}]},{"type":"label","elements":[{"id":3,"lua":false,"waitForResponse":false,"caption":"","name":"Label3","favourite":false,"main":false}]},{"type":"label","elements":[{"id":4,"lua":false,"waitForResponse":false,"caption":"","name":"Label4","favourite":false,"main":false}]},{"type":"label","elements":[{"id":5,"lua":false,"waitForResponse":false,"caption":"","name":"Label5","favourite":false,"main":false}]},{"type":"button","elements":[{"id":6,"lua":true,"waitForResponse":false,"caption":"模式123","name":"Button11","empty":false,"msg":"fibaro:setGlobal( \"HouseState\" , \"模式123\" )","buttonIcon":0,"favourite":false,"main":true},{"id":7,"lua":true,"waitForResponse":false,"caption":"Mode ABC","name":"Button12","empty":false,"msg":"fibaro:setGlobal( \"HouseState\" , \"Mode ABC\" )","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":8,"lua":true,"waitForResponse":false,"caption":"Event A","name":"Button21","empty":false,"msg":"local log = fibaro:getGlobal( \"EventLogs\" ) .. \"Event A;\"\nfibaro:setGlobal( \"EventLogs\" , log )","buttonIcon":0,"favourite":false,"main":false},{"id":9,"lua":true,"waitForResponse":false,"caption":"Event B","name":"Button22","empty":false,"msg":"local log = fibaro:getGlobal( \"EventLogs\" ) .. \"Event B;\"\nfibaro:setGlobal( \"EventLogs\" , log )","buttonIcon":0,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}